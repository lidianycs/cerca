name: CERCA Desktop Release alpha

on:
  workflow_dispatch:
  release:
    types: [published]

jobs:
  build:
    name: Build CERCA (${{ matrix.os }})
    runs-on: ${{ matrix.os }}

    strategy:
      fail-fast: false
      matrix:
        os: [windows-latest, ubuntu-latest, macos-latest]

    steps:
      # -----------------------------
      # Checkout
      # -----------------------------
      - name: Checkout source code
        uses: actions/checkout@v4

      # -----------------------------
      # Java setup (Azul Zulu + JavaFX)
      # -----------------------------
      - name: Set up Azul Zulu JDK with JavaFX
        uses: actions/setup-java@v4
        with:
          distribution: 'zulu'
          java-version: '17'
          java-package: 'jdk+fx'
          cache: 'maven'

      - name: Verify Java installation
        run: java -version

      # -----------------------------
      # Install CERMINE into local Maven repo
      # -----------------------------
      - name: Install CERMINE dependency
        shell: bash
        run: |
          CERMINE_JAR="$(pwd)/lib/cermine.jar"
          echo "Installing CERMINE from $CERMINE_JAR"
          mvn install:install-file \
            -Dfile="$CERMINE_JAR" \
            -DgroupId=pl.edu.icm \
            -DartifactId=cermine \
            -Dversion=1.13 \
            -Dpackaging=jar

      # -----------------------------
      # Build with Maven
      # -----------------------------
      - name: Build CERCA with Maven
        run: mvn clean package

      # -----------------------------
      # Prepare distribution folder
      # -----------------------------
      - name: Prepare artifacts
        run: |
          mkdir dist
          cp target/*.jar dist/
          rm dist/original-*.jar
        shell: bash

      # -----------------------------
      # Upload artifacts
      # -----------------------------
      - name: Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: CERCA-${{ runner.os }}
          path: dist/*
